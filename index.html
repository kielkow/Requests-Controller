<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>CRUD PLUSOFT</title>
</head>

<body>

    <h1 class="text-center">Controle de Pedidos</h1>

    <button class="btn btn-primary btn_novo" type="submit">+ Novo Pedido</button>
    <form class="form formAdd" style="display: none">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1">N° Pedido</span>
            </div>
            <input type="number" class="form-control input_numeroPedido" placeholder="Número do pedido"
                aria-label="Username" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1">Valor</span>
            </div>
            <input type="number" class="form-control input_valorProduto" placeholder="Valor do pedido"
                aria-label="Username" aria-describedby="basic-addon1">
        </div>
        <button class="btn btn-primary btn_salvar" type="submit" onclick="salvar()">Salvar</button>
    </form>

    <form class="form formConsulta">
        <div class="form-group">
            <label class="label" for="data">Pedido</label>
            <input type="number" class="form-control input_consulta" required autofocus
                placeholder="Digite o número do pedido" />
        </div>
        <button class="btn btn-primary btn_consultar" type="submit">Consultar</button>

        <table class="table tb_consulta" style="display: none">
            <thead>
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Pedido</th>
                    <th scope="col">Valor Total</th>
                    <th scope="col">Data Criação</th>
                    <th scope="col">ID criado</th>
                    <th scope="col">Data UP</th>
                    <th scope="col">ID UP</th>
                    <th scope="col">Protocolo</th>
                </tr>
            </thead>
            <tbody class="tbody_consulta"></tbody>
        </table>
    </form>


    <form class="form formListar">
        <div class="form-group">
            <label class="label label_listar" for="data">Pedidos Cadastrados</label>
        </div>
        <button class="btn btn-primary btn_listar" type="submit">Listar</button>

        <table class="table tb_listar" style="display: none">
            <thead class="thd_listar">
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Pedido</th>
                    <th scope="col">Valor Total</th>
                    <th scope="col">Data Criação</th>
                    <th scope="col">ID criado</th>
                    <th scope="col">Data UP</th>
                    <th scope="col">ID UP</th>
                    <th scope="col">Protocolo</th>
                </tr>
            </thead>
            <tbody class="tbody_listar"></tbody>
        </table>
    </form>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="script.js"></script>
    <script>
        $.ajax({
            type: "GET",
            url: "https://testapi.io/api/kielkow/pedidos",
            dataType: 'json',
            success: (pedidos) => {
                console.log('success', pedidos)
                for (let i = 0; i < pedidos.length; i++) {
                    let html = "<tr>";
                    html += "<th scope='col'>" + pedidos[i].id_cst_pedido + "</th>";
                    html += "<th scope='col'>" + pedidos[i].nr_pedido + "</th>";
                    html += "<th scope='col'>" + pedidos[i].vl_total + "</th>";
                    html += "<th scope='col'>" + pedidos[i].dt_created + "</th>";
                    html += "<th scope='col'>" + pedidos[i].id_usercreated + "</th>";
                    html += "<th scope='col'>" + pedidos[i].dt_updated + "</th>";
                    html += "<th scope='col'>" + pedidos[i].id_userupdated + "</th>";
                    html += "<th scope='col'>" + pedidos[i].ds_recordthumbprint + "</th>";
                    html += "<th scope='col'><button class='btn btn-primary btn_editar' type='submit'>!</button></th>"
                    html += "<th scope='col'><button class='btn btn-primary btn_excluir' type='submit'>X</button></th>"
                    html += "</tr>";
                    $(".thd_listar").append(html);
                }
                $(".tb_listar").toggle();
            },
            error: (error) => {
                console.log(error.status)
                alert('Não foi possível listar')
            }
        })

        let idPedido = document.querySelector(".input_consulta").value
        $.ajax({
            type: 'GET',
            url: 'https://testapi.io/api/kielkow/pedidos/5', //+ idPedido,
            dataType: 'json',
            success: (pedido) => {
                console.log(pedido)
                let html = "<tr>"
                html += "<th scope='col'>" + pedido.id_cst_pedido + "</th>";
                html += "<th scope='col'>" + pedido.nr_pedido + "</th>";
                html += "<th scope='col'>" + pedido.vl_total + "</th>";
                html += "<th scope='col'>" + pedido.dt_created + "</th>";
                html += "<th scope='col'>" + pedido.id_usercreated + "</th>";
                html += "<th scope='col'>" + pedido.dt_updated + "</th>";
                html += "<th scope='col'>" + pedido.id_userupdated + "</th>";
                html += "<th scope='col'>" + pedido.ds_recordthumbprint + "</th>";
                html += "</tr>"
                $('.tbody_consulta').append(html)
                $(".tb_consulta").toggle();
            },
            error: (error) => {
                console.log(error.status)
                alert('Não foi possível buscar pedido ' + idPedido)
            }
        })

        function salvar() {
            let numPedido = document.querySelector('.input_numeroPedido');
            let vTot = document.querySelector('.input_valorProduto');

            document.querySelector('.input_numeroPedido').value = '';
            document.querySelector('.input_valorProduto').value = '';

            let pedido = {
                "nr_pedido": numPedido,
                "vl_total": vTot,
            }

            $.ajax({
                type: 'POST',
                url: 'https://testapi.io/api/kielkow/pedidos',
                data: pedido,
                success: function (novoPedido) {
                    console.log(novoPedido)
                    alert("Pedido salvo com sucesso")
                    let html = "<tr>"
                    html += "<th scope='col'>" + pedido.id_cst_pedido + "</th>";
                    html += "<th scope='col'>" + pedido.nr_pedido + "</th>";
                    html += "<th scope='col'>" + pedido.vl_total + "</th>";
                    html += "<th scope='col'>" + pedido.dt_created + "</th>";
                    html += "<th scope='col'>" + pedido.id_usercreated + "</th>";
                    html += "<th scope='col'>" + pedido.dt_updated + "</th>";
                    html += "<th scope='col'>" + pedido.id_userupdated + "</th>";
                    html += "<th scope='col'>" + pedido.ds_recordthumbprint + "</th>";
                    html += "</tr>"
                    $('.tbody_consulta').append(html)
                },
                error: (error) => {
                    console.log(error)
                    alert('Não foi possível salvar pedido')
                }
            })
        };
    </script>

</body>

</html>
